---
title: 反扒措施
date: 2019-06-14 15:38:26
tags: 
	- "爬虫"
	- "Python"
summary: 一些简单的反扒措施
cover: 
img: https://raw.githubusercontent.com/CityNorth/material/master/image/backspiders.png
categories: "爬虫"	
---
## 爬虫常见反扒措施

在互联网上爬取数据的过程中难免出现ip被封或者服务器返回403等等，这可能是你被网站检测为爬虫而采取的反爬措施，本文主要总结了一些常见的情况及规避的措施。

### 构造合理的请求头
HTTP 的请求头是在你每次向网络服务器发送请求时，传递的一组属性和配置信息。HTTP 定义了十几种古怪的请求头类型，不过大多数都不常用。
较为常用的是 `Cookie`  `User-Agent`。尤其是`User-Agent`，这个没有大多数网站是请求不到的，`Cookie`中包含了你的登录信息。

	from fake_useragent import UserAgent
	headers = {
	            'Cookie':'' ,
	            'User-Agent': user_agent.random
	            }

另外，请求头还可能让网站改变内容的布局样式。例如，用移动设备浏览网站时，通常会看到一个没有广告、Flash以及其他干扰的简化的网站版本。因此，把你的请求头User-Agent改成下面这样，也许就可以看到一个更容易采集的网站了。

`User-Agent:Mozilla/5.0 (iPhone; CPU iPhone OS 7_1_2 like Mac OS X) App leWebKit/537.51.2 (KHTML, like Gecko) Version/7.0 Mobile/11D257 Safari/9537.53`

### 使用代理

使用代理也是一种较为常见的方法，使用方法较为简单，只是使用前一定有确定ip可用。
		
		import requests
		proxies = {
		    "http": "XXX.XX.XX.XX:XX",
		}
		print requests.get('http://www.ip181.com/',proxies=proxies).content

[http://www.xdaili.cn/monitor](http://www.xdaili.cn/monitor "http://www.xdaili.cn/monitor") 是一个可以检测代理IP的网站，它可以检测出你使用的ip是什么，正好可以用来检验自己是否使用代理ip成功。如果你有多个代理IP，那么可以建立一个IP池，每次随机从IP池中选择一个进行访问，如果访问失败了，则将其从池中去除即可。

### 图形验证码的识别

import tesserocr
from PIL import Image

def get_image():
	#将网页截屏
    browser.save_screenshot('jietu.png')
    img=browser.find_element_by_id("chkimg")
    location = img.location
#     print(location)
    size =img.size
    left = location['x']
    top = location['y']
    right = left + size['width']
    bottom = top + size['height']

    i=Image.open("jietu.png")
    image_obj =i.crop((left, top, right, bottom))
    image_obj.save('yzm.png')
    image=Image.open('yzm.png')
    
    #向量化处理图片  方便识别
    image=image.convert("L")
    #调整阈值，
    threshold=80
    table=[]
    for i in range(256):
        if i <threshold:
            table.append(0)
        else:
            table.append(1)
    image=image.point(table,'1')
#     image.show()

    yzm=tesserocr.image_to_text(image)
    yzm=yzm.strip()[1:]
    browser.find_element_by_id("verifyCode").clear()
    browser.find_element_by_id("verifyCode").send_keys(yzm)

方法一
import tesserocr
from PIL import Image

image = Image.open('code2.jpg')
result = tesserocr.image_to_text(image)
print(result)